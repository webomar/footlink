{% extends 'theme/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load custom_tags %}

{% block content %}
<!-- **************** MAIN CONTENT START **************** -->
<main>
	
	<!-- Container START -->
	<div class="container">
		<div class="row g-4">
			{% include 'theme/sidenav.html' %}
			<!-- Main content START -->
			<div class="col-md-8 col-lg-6 vstack gap-4">

				{% comment %} <!-- Story START -->
        <div class="d-flex gap-2 mb-n3">
					<div class="position-relative">
						<div class="card border border-2 border-dashed h-150px px-4 px-sm-5 shadow-none d-flex align-items-center justify-content-center text-center">
							<div>
								<a class="stretched-link btn btn-light rounded-circle icon-md" href="#!"><i class="fa-solid fa-plus"></i></a>
								<h6 class="mt-2 mb-0 small">Post a Story</h6>
							</div>
						</div>
					</div>

					<!-- Stories -->
					<div id="stories" class="storiesWrapper stories-square stories user-icon carousel scroll-enable"></div>
				</div>
        <!-- Story END --> {% endcomment %}








				{% comment %} {% for post in posts reversed%}
					{{post}}
					{{post.user.first_name}}
					{{post.user.last_name}}
					{{post.text}}

					{% for media in post.media_set.all %}
					{% if media.is_image %}
					  <img src="{{ media.file.url }}" alt="Image">
					{% elif media.is_video %}
					  <video controls>
						<source src="{{ media.file.url }}" type="video/mp4">
						Your browser does not support the video tag.
					  </video>
					{% endif %}
				  {% endfor %}

				{% endfor %} {% endcomment %}



















				{% include 'theme/parts/share_post.html' %}







				{% for post, duration, comments in posts reversed%}
					  {% include 'theme/parts/post.html' %}
				{% endfor %}

				{% include 'theme/demo/posts.html' %}


					<!-- Load more button START -->
					<a href="#!" role="button" class="btn btn-loader btn-primary-soft" data-bs-toggle="button" aria-pressed="true">
						<span class="load-text"> Load more </span>
						<div class="load-icon">
							<div class="spinner-grow spinner-grow-sm" role="status">
								<span class="visually-hidden">Loading...</span>
							</div>
						</div>
					</a>
					<!-- Load more button END -->

			</div>
			<!-- Main content END -->

			<!-- Right sidebar START -->
			<div class="col-lg-3">
				<div class="row g-4">
					<!-- Card follow START -->
					<div class="col-sm-6 col-lg-12">
						<div class="card">
							<!-- Card header START -->
							<div class="card-header pb-0 border-0">
								<h5 class="card-title mb-0">Who to follow</h5>
							</div>
							<!-- Card header END -->
							<!-- Card body START -->
							<div class="card-body">
								{% for user in users %}
								<!-- Connection item START -->
								<div class="hstack gap-2 mb-3">
									<!-- Avatar -->
									<div class="avatar">
										<a href="{% url 'profile' username=user.username %}"><img class="avatar-img rounded-circle" src="{{ user.getProfileimageUrl }}" alt=""></a>
									</div>
									<!-- Title -->
									<div class="overflow-hidden">
										<a class="h6 mb-0" href="{% url 'profile' username=user.username %}">{{user.getFullName}} </a>
										<p class="mb-0 small text-truncate">{{user.player.position}} at {{user.player.club}}</p>
									</div>
									<!-- Button -->
									<a class="btn btn-primary-soft rounded-circle icon-md ms-auto" href="#"><i class="fa-solid fa-plus"> </i></a>
								</div>
								<!-- Connection item END -->








								{% endfor %}
								<!-- View more button -->
								<div class="d-grid mt-3">
									<a class="btn btn-sm btn-primary-soft" href="{% url 'discover' %}">View more</a>
								</div>
							</div>
							<!-- Card body END -->
						</div>
					</div>
					<!-- Card follow START -->

					{% comment %} <!-- Card News START -->
					<div class="col-sm-6 col-lg-12">
						<div class="card">
							<!-- Card header START -->
							<div class="card-header pb-0 border-0">
								<h5 class="card-title mb-0">Todayâ€™s news</h5>
							</div>
							<!-- Card header END -->
							<!-- Card body START -->
							<div class="card-body">
								<!-- News item -->
								<div class="mb-3">
									<h6 class="mb-0"><a href="blog-details.html">Ten questions you should answer truthfully</a></h6>
									<small>2hr</small>
								</div>
								<!-- News item -->
								<div class="mb-3">
									<h6 class="mb-0"><a href="blog-details.html">Five unbelievable facts about money</a></h6>
									<small>3hr</small>
								</div>
								<!-- News item -->
								<div class="mb-3">
									<h6 class="mb-0"><a href="blog-details.html">Best Pinterest Boards for learning about business</a></h6>
									<small>4hr</small>
								</div>
								<!-- News item -->
								<div class="mb-3">
									<h6 class="mb-0"><a href="blog-details.html">Skills that you can learn from business</a></h6>
									<small>6hr</small>
								</div>
								<!-- Load more comments -->
								<a href="#!" role="button" class="btn btn-link btn-link-loader btn-sm text-secondary d-flex align-items-center" data-bs-toggle="button" aria-pressed="true">
									<div class="spinner-dots me-2">
										<span class="spinner-dot"></span>
										<span class="spinner-dot"></span>
										<span class="spinner-dot"></span>
									</div>
									View all latest news
								</a>
							</div>
							<!-- Card body END -->
						</div>
					</div>
					<!-- Card News END --> {% endcomment %}
					
				</div>
			</div>
			<!-- Right sidebar END -->

		</div> <!-- Row END -->
	</div>
	<!-- Container END -->

</main>
<!-- **************** MAIN CONTENT END **************** -->
{% comment %} {% include 'theme/parts/chat.html' %} {% endcomment %}
<!-- Modal create Feed START -->
<div class="modal fade" id="modalCreateFeed" tabindex="-1" aria-labelledby="modalLabelCreateFeed" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
		<div class="modal-content">
			<!-- Modal feed header START -->
			<div class="modal-header">
				<h5 class="modal-title" id="modalLabelCreateFeed">Create post</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<!-- Modal feed header END -->

			<!-- Modal feed body START -->
			<div class="modal-body">
				 <!-- Add Feed -->
				 <div class="d-flex mb-3">
					<!-- Avatar -->
					<div class="avatar avatar-xs me-2">
						<img class="avatar-img rounded-circle" src="assets/images/avatar/03.jpg" alt="">
					</div>
					<!-- Feed box  -->
					<form class="w-100">
						<textarea class="form-control pe-4 fs-3 lh-1 border-0" rows="4" placeholder="Share your thoughts..." autofocus></textarea>
					</form>
				</div>
				<!-- Feed rect START -->
				<div class="hstack gap-2">
					<a class="icon-md bg-success bg-opacity-10 text-success rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Photo"> <i class="bi bi-image-fill"></i> </a>
					<a class="icon-md bg-info bg-opacity-10 text-info rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Video"> <i class="bi bi-camera-reels-fill"></i> </a>
					<a class="icon-md bg-danger bg-opacity-10 text-danger rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Events"> <i class="bi bi-calendar2-event-fill"></i> </a>
					<a class="icon-md bg-warning bg-opacity-10 text-warning rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Feeling/Activity"> <i class="bi bi-emoji-smile-fill"></i> </a>
					<a class="icon-md bg-light text-secondary rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Check in"> <i class="bi bi-geo-alt-fill"></i> </a>
					<a class="icon-md bg-primary bg-opacity-10 text-primary rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Tag people on top"> <i class="bi bi-tag-fill"></i> </a>
				</div>
				<!-- Feed rect END -->
			</div>
			<!-- Modal feed body END -->

			<!-- Modal feed footer -->
			<div class="modal-footer row justify-content-between">
				<!-- Select -->
				<div class="col-lg-3">
					<select class="form-select js-choice choice-select-text-none" data-position="top" data-search-enabled="false">
						<option value="PB">Public</option>
						<option value="PV">Friends</option>
						<option value="PV">Only me</option>
						<option value="PV">Custom</option>
					</select>
				<!-- Button -->
				</div>
				<div class="col-lg-8 text-sm-end">
					<button type="button" class="btn btn-danger-soft me-2"> <i class="bi bi-camera-video-fill pe-1"></i> Live video</button>
					<button type="button" class="btn btn-success-soft">Post</button>
				</div>
			</div>
			<!-- Modal feed footer -->

		</div>
	</div>
</div>
<!-- Modal create feed END -->

<!-- Modal create Feed photo START -->
<div class="modal fade" id="feedActionPhoto" tabindex="-1" aria-labelledby="feedActionPhotoLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<!-- Modal feed header START -->
			<div class="modal-header">
				<h5 class="modal-title" id="feedActionPhotoLabel">Add post photo</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<!-- Modal feed header END -->

				<!-- Modal feed body START -->
				<div class="modal-body">
				<!-- Add Feed -->
				<div class="d-flex mb-3">
					<!-- Avatar -->
					{% comment %} <div class="avatar avatar-xs me-2">
						<img class="avatar-img rounded-circle" src="assets/images/avatar/03.jpg" alt="">
					</div> {% endcomment %}
					<!-- Feed box  -->
					{% comment %} <form class="w-100">
						<textarea class="form-control pe-4 fs-3 lh-1 border-0" rows="2" placeholder="Share your thoughts..."></textarea>
					</form> {% endcomment %}



















{% comment %} 					
					<form method="post" enctype="multipart/form-data">
						{% csrf_token %}
						{{ form|crispy }}
						<button type="submit" class="btn btn-primary">Submit</button>
					</form> {% endcomment %}






				</div>

				<!-- Dropzone photo START -->
				<div>
					<label class="form-label">Upload attachmfffent</label>
					<div class="dropzone dropzone-default card shadow-none" data-dropzone='{"maxFiles":2}'>
						<div class="dz-message">
							<i class="bi bi-images display-3"></i>
							<p>Drag here or click to upload photo.</p>
						</div>
					</div>
				</div>
				<!-- Dropzone photo END -->

				</div>
				<!-- Modal feed body END -->
{% comment %} 
				<!-- Modal feed footer -->
				<div class="modal-footer ">
					<!-- Button -->
						<button type="button" class="btn btn-danger-soft me-2" data-bs-dismiss="modal">Cancel</button>
						<button type="button" class="btn btn-success-soft">Post</button>
				</div>
				<!-- Modal feed footer --> {% endcomment %}
		</div>
	</div>
</div>
<!-- Modal create Feed photo END -->

<!-- Modal create Feed video START -->
<div class="modal fade" id="feedActionVideo" tabindex="-1" aria-labelledby="feedActionVideoLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
		 <!-- Modal feed header START -->
		 <div class="modal-header">
			<h5 class="modal-title" id="feedActionVideoLabel">Add post video</h5>
			<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>
		<!-- Modal feed header END -->

			<!-- Modal feed body START -->
			<div class="modal-body">
			 <!-- Add Feed -->
			 <div class="d-flex mb-3">
				<!-- Avatar -->
				<div class="avatar avatar-xs me-2">
					<img class="avatar-img rounded-circle" src="assets/images/avatar/03.jpg" alt="">
				</div>
				<!-- Feed box  -->
				<form class="w-100">
					<textarea class="form-control pe-4 fs-3 lh-1 border-0" rows="2" placeholder="Share your thoughts..."></textarea>
				</form>
			</div>

			<!-- Dropzone photo START -->
			<div>
				<label class="form-label">Upload attachment</label>
				<div class="dropzone dropzone-default card shadow-none" data-dropzone='{"maxFiles":2}'>
					<div class="dz-message">
						<i class="bi bi-camera-reels display-3"></i>
								<p>Drag here or click to upload video.</p>
					</div>
				</div>
			</div>
			<!-- Dropzone photo END -->

		</div>
			<!-- Modal feed body END -->

			<!-- Modal feed footer -->
			<div class="modal-footer">
				<!-- Button -->
				<button type="button" class="btn btn-danger-soft me-2"><i class="bi bi-camera-video-fill pe-1"></i> Live video</button>
				<button type="button" class="btn btn-success-soft">Post</button>
			</div>
			<!-- Modal feed footer -->
		</div>
	</div>
</div>
<!-- Modal create Feed video END -->

<!-- Modal create events START -->
<div class="modal fade" id="modalCreateEvents" tabindex="-1" aria-labelledby="modalLabelCreateAlbum" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<!-- Modal feed header START -->
			<div class="modal-header">
				<h5 class="modal-title" id="modalLabelCreateAlbum">Create event</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<!-- Modal feed header END -->
			<!-- Modal feed body START -->
			<div class="modal-body">
				<!-- Form START -->
				<form class="row g-4">
					<!-- Title -->
					<div class="col-12">
						<label class="form-label">Title</label>
						<input type="email" class="form-control" placeholder="Event name here">
					</div>
					<!-- Description -->
					<div class="col-12">
						<label class="form-label">Description</label>
						<textarea class="form-control" rows="2" placeholder="Ex: topics, schedule, etc."></textarea>
					</div>
					<!-- Date -->
					<div class="col-sm-4">
						<label class="form-label">Date</label>
						<input type="text" class="form-control flatpickr" placeholder="Select date">
					</div>
					<!-- Time -->
					<div class="col-sm-4">
						<label class="form-label">Time</label>
						<input type="text" class="form-control flatpickr" data-enableTime="true" data-noCalendar="true" placeholder="Select time">
					</div>
					<!-- Duration -->
					<div class="col-sm-4">
						<label class="form-label">Duration</label>
						<input type="email" class="form-control" placeholder="1hr 23m">
					</div>
					<!-- Location -->
					<div class="col-12">
						<label class="form-label">Location</label>
						<input type="email" class="form-control" placeholder="Logansport, IN 46947">
					</div>
					<!-- Add guests -->
					<div class="col-12">
						<label class="form-label">Add guests</label>
						<input type="email" class="form-control" placeholder="Guest email">
					</div>
					<!-- Avatar group START -->
					<div class="col-12 mt-3">
						<ul class="avatar-group list-unstyled align-items-center mb-0">
							<li class="avatar avatar-xs">
								<img class="avatar-img rounded-circle" src="{% static 'assets/images/post/3by2/01.jpg' %}" alt="avatar">
							</li>
							<li class="avatar avatar-xs">
								<img class="avatar-img rounded-circle" src="{% static 'assets/images/post/3by2/02.jpg' %}" alt="avatar">
							</li>
							<li class="avatar avatar-xs">
								<img class="avatar-img rounded-circle" src="{% static 'assets/images/post/3by2/03.jpg' %}" alt="avatar">
							</li>
							<li class="avatar avatar-xs">
								<img class="avatar-img rounded-circle" src="{% static 'assets/images/post/3by2/04.jpg' %}" alt="avatar">
							</li>
							<li class="avatar avatar-xs">
								<img class="avatar-img rounded-circle" src="{% static 'assets/images/post/3by2/05.jpg' %}" alt="avatar">
							</li>
							<li class="avatar avatar-xs">
								<img class="avatar-img rounded-circle" src="{% static 'assets/images/post/3by2/06.jpg' %}" alt="avatar">
							</li>
							<li class="avatar avatar-xs">
								<img class="avatar-img rounded-circle" src="{% static 'assets/images/post/3by2/01.jpg' %}" alt="avatar">
							</li>
							<li class="ms-3">
								<small> +50 </small>
							</li>
						</ul>
					</div>
					<!-- Upload Photos or Videos -->
					<!-- Dropzone photo START -->
					<div>
						<label class="form-label">Upload attachment</label>
						<div class="dropzone dropzone-default card shadow-none" data-dropzone='{"maxFiles":2}'>
							<div class="dz-message">
								<i class="bi bi-file-earmark-text display-3"></i>
								<p>Drop presentation and document here or click to upload.</p>
							</div>
						</div>
					</div>
					<!-- Dropzone photo END -->
				</form>
				<!-- Form END -->
			</div>
			<!-- Modal feed body END -->
			<!-- Modal footer -->
			<!-- Button -->
			<div class="modal-footer">
				<button type="button" class="btn btn-danger-soft me-2" data-bs-dismiss="modal"> Cancel</button>
				<button type="button" class="btn btn-success-soft">Create now</button>
			</div>
		</div>
	</div>
</div>




<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function () {
   var csrfToken = $('input[name=csrfmiddlewaretoken]').val(); // Get the CSRF token

   $('.like-button').click(function () {
	   var postId = $(this).data('post-id');
	   console.log(postId)

	   $.ajax({
		   type: 'POST',
		   url: '/like_post/' + postId + '/',
		   data: {},
		   headers: { "X-CSRFToken": csrfToken }, // Include the CSRF token in the headers
		   success: function (data) {

			   if(data.remove == true){
				$('#like-text-' + postId).text('Like');
				$('#like-button-' + postId).removeClass('active');
				$('#like-count-' + postId).text(data.likes_count);

			   }
			   else{
			   // Update the like count for the specific post
			   $('#like-count-' + postId).text(data.likes_count);
			   $('#like-text-' + postId).text('Liked');
			   $('#like-button-' + postId).addClass('active');
			   }
			   console.log(data)
		   }
	   });
   });





   $('.comment-button').click(function () {
	var postId = $(this).data('post-id');
	console.log(postId)
	var comment_value = $('#comment-text-'+postId).val()
	console.log('comment_value')
	console.log(comment_value)
	$.ajax({
		type: 'POST',
		url: '/comment_post/' + postId + '/' + comment_value + '/',
		data: {},
		headers: { "X-CSRFToken": csrfToken }, // Include the CSRF token in the headers
		success: function (data) {
			// load fucking comments again
			$('#comment-count-' + postId).text(data.comment_count);

			// Clear the input field after a successful comment submission
			$('#comment-text-' + postId).val('');

                // Update the comment section with the newly added comment
                var commentSection = $('#comment-section-' + postId);
				var newCommentHTML = `
<li class="comment-item">
	<div class="d-flex position-relative">
		<!-- Avatar -->
		<div class="avatar avatar-xs">
			<a href="#!">
				<img class="avatar-img rounded-circle" src="`+data.comment.imgurl+`" alt="">
			</a>
		</div>
		<div class="ms-2">
			<!-- Comment by -->
			<div class="bg-light rounded-start-top-0 p-3 rounded">
				<div class="d-flex justify-content-between">
					<h6 class="mb-1"> <a href="#!"> `+data.comment.first_name +data.comment.last_name+`</a></h6>
					{% comment %} <small class="ms-2">5hr</small> {% endcomment %}
				</div>
				<p class="small mb-0">`+data.comment.text+`</p>
			</div>
			<!-- Comment react -->
			<ul class="nav nav-divider py-2 small">
				<li class="nav-item">
					<a class="nav-link" href="#!"> Like (3)</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="#!"> Reply</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="#!"> View 5 replies</a>
				</li>
			</ul>
		</div>
	</div>
</li>
`;
				var newComment = '<div class="comment">' +
					'<strong>' + data.comment.username + '</strong>: ' +
					data.comment.text +
					'</div>';
				commentSection.prepend(newCommentHTML);
		}
	});
});
});
</script>

{% endblock content %}